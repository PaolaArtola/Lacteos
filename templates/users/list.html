{% extends 'base.html' %}

{% block title %}Gestión de Usuarios - Lactería El Buen Sabor{% endblock %}

{% block extra_css %}
<style>
    .users-header {
        margin-bottom: 2rem;
        display: flex;
        justify-content: space-between;
        align-items: center;
        flex-wrap: wrap;
        gap: 1rem;
    }

    .users-header h1 {
        color: #2c5f2d;
        font-size: 2rem;
        margin: 0;
    }

    .filters {
        display: flex;
        gap: 1rem;
        flex-wrap: wrap;
    }

    .filter-group {
        display: flex;
        gap: 0.5rem;
        align-items: center;
    }

    .filter-group input,
    .filter-group select {
        padding: 0.5rem;
        border: 1px solid #ddd;
        border-radius: 4px;
        font-size: 0.9rem;
    }

    .users-table {
        background: white;
        border-radius: 8px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        overflow: hidden;
    }

    .table {
        width: 100%;
        border-collapse: collapse;
    }

    .table th,
    .table td {
        padding: 1rem;
        text-align: left;
        border-bottom: 1px solid #e0e0e0;
    }

    .table th {
        background-color: #f8f9fa;
        font-weight: 600;
        color: #555;
        text-transform: uppercase;
        font-size: 0.85rem;
        letter-spacing: 0.5px;
    }

    .table tbody tr:hover {
        background-color: #f8f9fa;
    }

    .table tbody tr:last-child td {
        border-bottom: none;
    }

    .badge {
        display: inline-block;
        padding: 0.25rem 0.75rem;
        border-radius: 12px;
        font-size: 0.85rem;
        font-weight: 500;
    }

    .badge-admin {
        background-color: #dc3545;
        color: white;
    }

    .badge-employee {
        background-color: #ffc107;
        color: #333;
    }

    .badge-customer {
        background-color: #17a2b8;
        color: white;
    }

    .badge-active {
        background-color: #28a745;
        color: white;
    }

    .badge-inactive {
        background-color: #6c757d;
        color: white;
    }

    .action-buttons {
        display: flex;
        gap: 0.5rem;
    }

    .btn-sm {
        padding: 0.375rem 0.75rem;
        font-size: 0.875rem;
    }
</style>
{% endblock %}

{% block content %}
<div class="users-header">
    <h1>Gestión de Usuarios</h1>
    <div class="filters">
        <form method="get" class="filter-group">
            <input type="text" name="search" placeholder="Buscar usuarios..." value="{{ search_query }}" class="filter-input">
            <select name="role" class="filter-select">
                <option value="">Todos los roles</option>
                {% for value, label in role_choices %}
                <option value="{{ value }}" {% if role_filter == value %}selected{% endif %}>{{ label }}</option>
                {% endfor %}
            </select>
            <button type="submit" class="btn btn-primary">Buscar</button>
            {% if search_query or role_filter %}
            <a href="{% url 'lacteos:user_management' %}" class="btn btn-secondary">Limpiar</a>
            {% endif %}
        </form>
    </div>
</div>

<div class="users-table">
    <table class="table">
        <thead>
            <tr>
                <th>Usuario</th>
                <th>Email</th>
                <th>Nombre</th>
                <th>Rol</th>
                <th>Estado</th>
                <th>Fecha Registro</th>
                <th>Acciones</th>
            </tr>
        </thead>
        <tbody>
            {% for user in users %}
            <tr>
                <td><strong>{{ user.username }}</strong></td>
                <td>{{ user.email|default:"-" }}</td>
                <td>{{ user.get_full_name|default:"-" }}</td>
                <td>
                    {% if user.profile.role == 'admin' %}
                        <span class="badge badge-admin">Administrador</span>
                    {% elif user.profile.role == 'employee' %}
                        <span class="badge badge-employee">Empleado</span>
                    {% else %}
                        <span class="badge badge-customer">Cliente</span>
                    {% endif %}
                </td>
                <td>
                    {% if user.is_active %}
                        <span class="badge badge-active">Activo</span>
                    {% else %}
                        <span class="badge badge-inactive">Inactivo</span>
                    {% endif %}
                </td>
                <td>{{ user.date_joined|date:"M d, Y" }}</td>
                <td>
                    <div class="action-buttons">
                        <a href="{% url 'lacteos:user_detail' user.pk %}" class="btn btn-primary btn-sm">Editar</a>
                        {% if user != request.user %}
                        <a href="{% url 'lacteos:user_delete' user.pk %}" class="btn btn-secondary btn-sm" style="background: #dc3545; color: white;">Eliminar</a>
                        {% endif %}
                    </div>
                </td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="7" style="text-align: center; padding: 2rem; color: #666;">
                    No se encontraron usuarios con los filtros seleccionados.
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endblock %}

